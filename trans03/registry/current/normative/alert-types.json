openapi: 3.0.3
info:
  title: 4S Normative Alert Types API (Appendix H)
  description: |-
    REST API for the official Appendix H alert type registry containing 65 standardized codes 
    across 10 categories with 4S required status. Supports validation, lookup, and filtering.
  version: current
  x-logo:
    url: 'https://registry.4s-safety.com/schemas/index.html'
servers:
  - url: '{protocol}://{host}/registry/current/normative'
    description: Production normative registry
    variables:
      protocol:
        enum: [http, https]
        default: https
      host:
        default: registry.4s-safety.com
tags:
  - name: alert-types
    description: Appendix H - 65 standardized alert codes
  - name: lookup
    description: Code search and validation
  - name: stats
    description: Registry statistics and compliance
paths:
  /alert-types.json:
    get:
      tags: [alert-types]
      summary: Complete Alert Types Registry
      description: Full Appendix H normative registry (65 types)
      parameters:
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/CategoryQuery'
          description: Filter by category
        - name: required
          in: query
          schema:
            type: boolean
          description: Filter 4S required types only
      responses:
        '200':
          description: Complete or filtered alert types
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertTypesResponse'
  /alert-types/{category}:
    get:
      tags: [alert-types]
      summary: Category-Specific Alert Types
      parameters:
        - name: category
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/CategoryParam'
      responses:
        '200':
          description: Category alert types
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryAlertTypes'
        '404':
          description: Category not found
  /alert-types/validate/{code}:
    get:
      tags: [lookup]
      summary: Validate Alert Type Code
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            pattern: '^[a-z0-9-]+$'  
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/CategoryQuery'
      responses:
        '200':
          description: Valid code details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationResponse'
        '404':
          description: Invalid code
  /alert-types/stats:
    get:
      tags: [stats]
      summary: Registry Statistics
      description: Compliance metrics and counts
      responses:
        '200':
          description: Usage statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatsResponse'
  /alert-types/search:
    get:
      tags: [lookup]
      summary: Search Alert Types
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 2
          description: Search term
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/CategoryQuery'
        - name: required
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Matching alert types
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
components:
  schemas:
    AlertType:
      type: object
      required: [code, name, required]
      properties:
        code:
          type: string
          pattern: '^[a-z0-9-]+$'  
          example: "fall-detection"
        name:
          type: string
          example: "Fall detection"
        required:
          type: boolean
          description: "4S compliance requirement"
          example: true
        category:
          type: string
          example: "smart-monitoring-device"
    CategoryAlertTypes:
      type: object
      required: [category, codes, requiredCount]
      properties:
        category:
          type: string
          enum:
            - smart-monitoring-device
            - tower-crane
            - mobile-plant-operation
            - ai-monitoring
            - confined-space
            - lock-key
            - scaffold-coupler
            - mewp
            - e-permit
            - digitalised-tracking-system
        description:
          type: string
        requiredCount:
          type: integer
          example: 6
        codes:
          type: array
          items:
            $ref: '#/components/schemas/AlertType'
    AlertTypesResponse:
      type: object
      properties:
        total:
          type: integer
          example: 65
        required:
          type: integer
          example: 42
        optional:
          type: integer
          example: 23
        types:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/CategoryAlertTypes'
    ValidationResponse:
      type: object
      properties:
        valid:
          type: boolean
        code:
          type: string
        details:
          $ref: '#/components/schemas/AlertType'
        compliant:
          type: boolean
          description: "Meets 4S required status"
    SearchResponse:
      type: object
      properties:
        query:
          type: string
        matches:
          type: array
          items:
            $ref: '#/components/schemas/AlertType'
        total:
          type: integer
    StatsResponse:
      type: object
      properties:
        totalTypes: { type: integer, example: 65 }
        requiredTypes: { type: integer, example: 42 }
        optionalTypes: { type: integer, example: 23 }
        byCategory:
          type: object
          additionalProperties:
            type: integer
        complianceRate:
          type: number
          example: 0.646  # 42/65
    CategoryParam:
      type: string
      enum:
        - smart-monitoring-device
        - tower-crane
        - mobile-plant-operation
        - ai-monitoring
        - confined-space
        - lock-key
        - scaffold-coupler
        - mewp
        - e-permit
        - digitalised-tracking-system
      example: "smart-monitoring-device"
    CategoryQuery:
      type: string
      enum:
        - smart-monitoring-device
        - tower-crane
        - mobile-plant-operation
        - ai-monitoring
        - confined-space
        - lock-key
        - scaffold-coupler
        - mewp
        - e-permit
        - digitalised-tracking-system
      nullable: true
  parameters: {}
security: []
externalDocs:
  description: Full Appendix H Specification
  url: 'https://registry.4s-safety.com/schemas/docs/implementation-guide.md#appendix-h'
